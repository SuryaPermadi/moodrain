<!DOCTYPE html>
<html lang="id" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoodRain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="h-full bg-gradient-to-b from-purple-600 to-blue-600 text-white">
    <div class="min-h-screen flex flex-col items-center justify-center p-6">
      <h1 class="text-5xl font-bold mb-4 animate-pulse">MoodRain</h1>
      <p class="text-xl mb-10 text-center">Biarkan cuaca yang pilihkan lagumu hari ini</p>

      <div id="welcome" class="text-center">
        <button onclick="getLocation()" class="bg-white text-purple-600 px-10 py-5 rounded-full text-xl font-bold shadow-2xl hover:scale-105 transition">üéß Mulai Dengar Sesuai Cuaca</button>
      </div>

      <div id="result" class="hidden mt-10 text-center">
        <div class="text-6xl mb-4" id="emoji">‚è≥</div>
        <h2 class="text-3xl font-bold" id="city"></h2>
        <p class="text-2xl mt-2" id="weather"></p>
        <p class="mt-6 text-lg">Sedang buka Spotify...</p>
      </div>
    </div>

    <!-- Ganti ini dengan punya kamu -->
    <script>
      const playlists = {
        Rain: "37i9dQZF1DX6z0cObxbJtK",
        Drizzle: "37i9dQZF1DWUbo613Z8OBF",
        Thunderstorm: "37i9dQZF1DX6z0cObxbJtK",
        Clouds: "37i9dQZF1DX4sWSpwqZYMQ",
        Clear: "37i9dQZF1DX4FpCKJgdi2K",
        default: "37i9dQZF1DX0XUsuxWHRQd",
      };

      function getLocation() {
        document.getElementById("welcome").classList.add("hidden");
        document.getElementById("result").classList.remove("hidden");
        document.getElementById("emoji").innerText = "...";
        document.getElementById("city").innerText = "Mencari lokasi...";

        navigator.geolocation.getCurrentPosition(success, error);
      }

      async function success(pos) {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        try {
          // Pakai wttr.in ‚Äî langsung jalan tanpa key!
          const res = await fetch(`https://wttr.in/?format=j1`);
          const data = await res.json();

          const city = data.nearest_area[0].areaName[0].value;
          const condition = data.current_condition[0].weatherDesc[0].value;
          const temp = data.current_condition[0].temp_C;

          document.getElementById("city").innerText = city;
          document.getElementById("weather").innerText = `${condition} ‚Ä¢ ${temp}¬∞C`;

          let key = "default";
          if (condition.toLowerCase().includes("rain") || condition.toLowerCase().includes("drizzle")) key = "Rain";
          else if (condition.toLowerCase().includes("cloud")) key = "Clouds";
          else if (condition.toLowerCase().includes("clear") || condition.toLowerCase().includes("sunny")) key = "Clear";

          document.getElementById("emoji").innerText = key === "Rain" ? "Rain" : key === "Clouds" ? "Clouds" : "Clear";

          setTimeout(() => {
            window.location.href = `https://open.spotify.com/playlist/${playlists[key]}?si=moodrain`;
          }, 1200);
        } catch (err) {
          document.getElementById("city").innerText = "Error";
          document.getElementById("weather").innerText = "Coba lagi 1x";
        }
      }

      function error() {
        document.getElementById("emoji").innerText = "Error";
        document.getElementById("city").innerText = "Lokasi ditolak";
      }
    </script>
  </body>
</html>
