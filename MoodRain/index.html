<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoodRain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700;900&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Space Grotesk", sans-serif;
        margin: 0;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 25%, #fad0c4 50%, #a18cd1 75%, #fbc2eb 100%);
        background-size: 400% 400%;
        animation: g 18s ease infinite;
      }
      @keyframes g {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .glass {
        background: rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <!-- Intro -->
    <div id="intro" class="text-center z-10">
      <h1 class="text-7xl sm:text-8xl md:text-9xl font-black text-white mb-6 drop-shadow-2xl">Mood<span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-violet-500">Rain</span></h1>
      <p class="text-xl sm:text-2xl text-white/90 mb-10">Cuaca menentukan lagu kamu hari ini</p>
      <button onclick="start()" class="glass px-12 py-6 rounded-full text-2xl font-bold text-white shadow-2xl hover:scale-110 transition">Putar Sesuai Cuaca</button>
    </div>

    <!-- Player — SEKARANG 100% RESPONSIVE & PAS -->
    <div id="player" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
      <div class="glass rounded-3xl w-full max-w-lg mx-auto overflow-hidden shadow-2xl">
        <!-- Header Cuaca -->
        <div class="p-8 text-center bg-white/10">
          <div class="text-8xl mb-4" id="emoji">Sun</div>
          <h2 class="text-4xl sm:text-5xl font-black text-white mb-2" id="city">Jakarta</h2>
          <p class="text-xl sm:text-2xl text-white/90" id="weather">Sunny • 31°C</p>
        </div>

        <!-- Spotify Player — tinggi pas di semua layar -->
        <div class="px-4 pb-6 pt-2">
          <iframe id="spotifyFrame" class="w-full rounded-2xl shadow-xl" height="352" src="" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"> </iframe>
        </div>

        <!-- Tombol ulang -->
        <div class="text-center pb-6">
          <button onclick="start()" class="text-white/70 hover:text-white text-sm">Coba cuaca lain</button>
        </div>
      </div>
    </div>

    <script>
      const playlists = {
        Rain: "37i9dQZF1DWTkxQvqMy4Bj",
        Clouds: "37i9dQZF1DX2sUQwD7tbmL",
        Clear: "37i9dQZF1DXa2PvUpywmrr",
        default: "37i9dQZF1DXcBWIGoYBM5M",
      };

      async function start() {
        document.getElementById("intro").classList.add("hidden");
        document.getElementById("player").classList.remove("hidden");

        document.getElementById("emoji").innerText = "Loading";
        document.getElementById("city").innerText = "Mencari lokasi...";

        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            try {
              const lat = pos.coords.latitude.toFixed(4);
              const lon = pos.coords.longitude.toFixed(4);
              const res = await fetch(`https://wttr.in/${lat},${lon}?format=j1`);
              const data = await res.json();

              const city = data.nearest_area[0].areaName[0].value;
              const condition = data.current_condition[0].weatherDesc[0].value.toLowerCase();
              const temp = data.current_condition[0].temp_C;

              let mood = "default";
              if (condition.includes("rain") || condition.includes("hujan")) mood = "Rain";
              else if (condition.includes("cloud") || condition.includes("berawan")) mood = "Clouds";
              else if (condition.includes("clear") || condition.includes("cerah") || condition.includes("sunny")) mood = "Clear";

              document.getElementById("city").innerText = city;
              document.getElementById("weather").innerText = `${data.current_condition[0].weatherDesc[0].value} • ${temp}°C`;
              document.getElementById("emoji").innerText = mood === "Rain" ? "Rain" : mood === "Clouds" ? "Clouds" : "Clear";

              document.getElementById("spotifyFrame").src = `https://open.spotify.com/embed/playlist/${playlists[mood]}?utm_source=moodrain&theme=0`;
            } catch (e) {
              document.getElementById("city").innerText = "Internet lelet";
              document.getElementById("weather").innerText = "Pake Top Hits aja";
              document.getElementById("spotifyFrame").src = "https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M";
            }
          },
          () => {
            document.getElementById("city").innerText = "Lokasi ditolak";
            document.getElementById("weather").innerText = "Pake random";
            document.getElementById("spotifyFrame").src = "https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M";
          }
        );
      }
    </script>
  </body>
</html>
